<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>C-Drama Tropes — Bingo (Classic / Chaotic / Madness)</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: linear-gradient(135deg, #ff6a00 0%, #ff9a00 40%, #ffd200 100%);
      --panel: #fff7edcc;

      --accent: #ff4500;
      --tile-bg: #ffffff;
      --tile-text: #000000;
      --tile-border: #e5e5e5;
      --done-bg: #55bd46;
      --done-text: #ffffff;
      --done-border: #4caa3f;

      --shadow: 0 4px 16px rgba(0,0,0,.08);
    }
    *{ box-sizing:border-box }
    html,body{ height:100% }
    body{
      margin:0;
      background:var(--bg);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji");
      color:#222;
      display:flex; flex-direction:column; align-items:center;
      padding:24px 16px 48px;
    }

    header{ width:min(1200px,96vw); display:flex; gap:16px; align-items:center; justify-content:space-between; margin-bottom:16px }
    .brand{ display:flex; align-items:center; gap:12px }
    .dot{ width:14px; height:14px; border-radius:50%; background:var(--accent); box-shadow:var(--shadow) }

    h1{ margin:0; letter-spacing:0.3px; display:flex; align-items:baseline; gap:10px; flex-wrap:wrap }
    /* dark & strong BINGO title for contrast */
    .logo-fancy{
      font-family:'Ma Shan Zheng', "Noto Serif SC", system-ui, sans-serif;
      font-size:clamp(44px, 7.5vw, 96px);
      letter-spacing:1px;
      background: linear-gradient(90deg,#2b0a00,#5c1600,#b32a00,#ff4d00);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      text-shadow: 0 3px 0 rgba(0,0,0,.55), 0 8px 22px rgba(0,0,0,.6), 0 0 3px rgba(0,0,0,.75);
    }
    .title-main{ font-family:'Cinzel', Georgia, 'Times New Roman', serif; font-weight:800; font-size:clamp(18px, 3.2vw, 34px); color:#1b1b1b }
    body.dark .title-main{ color:#e9eef5 }
    .subtitle{ font-size:12px; color:#666; opacity:.9; margin-top:2px }
    .edition-pill{ font-size:12px; font-weight:800; letter-spacing:.2px; background:#00000030; color:#fff; padding:4px 8px; border-radius:999px; margin-left:6px }

    .controls{ display:flex; flex-wrap:wrap; gap:8px }
    button{ appearance:none; border:none; cursor:pointer; font-weight:600; padding:10px 14px; border-radius:12px; background:#fff; color:#222; box-shadow:var(--shadow); border:1px solid #ececec }
    button:hover{ transform:translateY(-1px); box-shadow:0 6px 22px rgba(0,0,0,.12) }
    button:active{ transform:translateY(0) }
    .accent{ background:var(--accent); color:#fff; border-color:#e83e00 }
    .segmented{ display:flex; padding:3px; border-radius:12px; background:#ffffffbb; border:1px solid #ececec; box-shadow:var(--shadow) }
    .segmented button{ background:transparent; border:none; box-shadow:none; padding:8px 12px; border-radius:8px }
    .segmented button.active{ background:#111; color:#fff }
    .counter{ font-size:13px; color:#555; margin-left:8px }

    .wrap{ width:min(1200px,96vw); background:var(--panel); backdrop-filter: blur(6px); padding:16px; border-radius:18px; box-shadow:var(--shadow); border:1px solid #f0f0f0 }
    .board{ display:grid; gap:10px }
    .cols-5{ grid-template-columns: repeat(5, 1fr) }
    .cols-6{ grid-template-columns: repeat(6, 1fr) }

    .tile{
      background:var(--tile-bg); color:var(--tile-text); border:1px solid var(--tile-border);
      border-radius:16px; min-height:110px; padding:14px; box-shadow:var(--shadow);
      display:flex; align-items:center; justify-content:center; text-align:center;
      font-weight:700; font-size: clamp(11px, 1.15vw, 16px); line-height:1.25;
      user-select:none; transition:background .15s ease, border-color .15s ease, color .15s ease, transform .05s ease, box-shadow .15s ease;
    }
    .tile:hover{ transform: translateY(-1px) }
    .tile.done{ background:var(--done-bg); color:var(--done-text); border-color:var(--done-border) }

    .pulse{ animation: pulse 1.2s ease-in-out infinite }
    @keyframes pulse{ 0%{ filter: drop-shadow(0 0 0 rgba(255,69,0,.0)) } 50%{ filter: drop-shadow(0 0 14px rgba(255,69,0,.45)) } 100%{ filter: drop-shadow(0 0 0 rgba(255,69,0,.0)) } }
    .toast{ position:fixed; inset:auto 0 24px 0; display:flex; justify-content:center; pointer-events:none }
    .toast span{ pointer-events:auto; background:#000; color:#fff; padding:12px 18px; border-radius:14px; font-weight:800; box-shadow:0 10px 30px rgba(0,0,0,.25); opacity:0; transform: translateY(10px) scale(.98); transition: all .2s ease }
    .toast.show span{ opacity:1; transform: translateY(0) scale(1) }

    /* BIG CENTER POPUP "BINGO!" */
    .center-pop{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none; z-index:60 }
    .center-pop span{ font-weight:900; font-size:clamp(72px, 13vw, 200px); color:#fff; text-shadow:0 6px 24px rgba(0,0,0,.75), 0 0 10px rgba(0,0,0,.7); opacity:0; transform:scale(.55) }
    .center-pop.show span{ animation:pop .95s ease-out forwards }
    @keyframes pop{ 0%{ opacity:0; transform:scale(.55) } 55%{ opacity:1; transform:scale(1.4) } 100%{ opacity:1; transform:scale(1) } }

    /* Dark mode */
    .dark body, body.dark{
      --bg: linear-gradient(135deg, #0f1115 0%, #141922 60%, #1c2230 100%);
      --tile-bg:#1a1d24; --tile-text:#e9eef5; --tile-border:#2a2f3a;
      --done-bg:#55bd46; --done-text:#ffffff; --done-border:#4caa3f;
      --panel:#12151bcc; color:#e9eef5;
    }
    body.dark .wrap{ background:var(--panel) }
    body.dark button{ background:#1a1d24; color:#e9eef5; border-color:#2a2f3a }
    body.dark .accent{ background:var(--accent); color:#fff; border-color:#e83e00 }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="dot" aria-hidden="true"></div>
      <div>
        <h1>
          <span class="logo-fancy">BINGO</span>
          <span class="title-main">— C-Short Drama Tropes</span>
          <span id="edition" class="edition-pill">Classic Edition</span>
        </h1>
        <div class="subtitle" id="byline">by WildestLifeOfMine</div>
      </div>
    </div>
    <div class="controls">
      <div class="segmented" role="tablist" aria-label="Edition">
        <button id="btnClassic" role="tab" aria-selected="true" class="active">Classic</button>
        <button id="btnChaotic" role="tab" aria-selected="false">Chaotic</button>
        <button id="btnMadness" role="tab" aria-selected="false">Madness</button>
      </div>
      <button id="shuffle" class="accent" title="Shuffle a new board">Shuffle</button>
      <button id="clear" title="Clear all marks">Clear</button>
      <button id="copy" title="Copy link to this board">Copy link</button>
      <button id="mode" title="Toggle light/dark">Dark mode</button>
      <div class="counter" aria-live="polite">BINGO lines: <strong id="count">0</strong></div>
    </div>
  </header>

  <div class="wrap">
    <div id="board" class="board cols-5" role="grid" aria-label="Bingo"></div>
    <div class="meta">
      <span>Share via <code>?mode=...&seed=...</code>. States saved per seed & mode.</span>
    </div>
    <div class="center-pop" id="centerPop" aria-hidden="true"><span>BINGO!</span></div>
    <div class="toast" aria-live="assertive" aria-atomic="true"><span id="bingoMsg">BINGO!</span></div>
  </div>

  <script>
    /* === TERMS (tile texts) === */
    const TERMS_CLASSIC = [
      "FORCED TO DRINK OR DRUGGED",
      "WHITE MOONLIGHT",
      "FL MARRIES SML’S RELATIVE/FRIEND",
      "ML DOESN’T RECOGNIZE FL",
      "FORCED MAKE-OUT",
      "SFL STEALS FL’S IDENTITY",
      "EVIL (STEP) FAMILY",
      "FL TRIPS INTO ML",
      "WEDDING GETS CRASHED",
      "KNIFE OF FORGIVENESS",
      "SML REGRETS WHEN FL LEAVES",
      "YOU HIT ME?!",
      "EPIC ENTRANCE: CAR CONVOY",
      "GREEN TEA / WHITE LOTUS",
      "ML CARRIES/PICKS UP/PULLS INTO LAP FL",
      "ALLERGIC TO [ANYTHING]",
      "LOVED ONE TAKES THE WRONG SIDE / CHEATS",
      "AMNESIA PLOT",
      "TIME-TRAVEL PLOT",
      "ARRANGED MARRIAGE",
      "MARRIES CEO/BILLIONAIRE/MAFIA BOSS",
      "REBORN / REINCARNATION",
      "THERE’S AN AUCTION",
      "SECRET CHILD[REN]",
      "VOMITS BLOOD AFTER TRUTH",
    ];

    const TERMS_CHAOTIC = [
      "HE CATCHES HER… IN SLOW MOTION",
      "SHE TRIPS EVERY FIVE MINUTES",
      "CEO WEARS THE SAME BLACK SUIT",
      "CHILDHOOD BRACELET CONNECTION",
      "IT’S NOT WHAT IT LOOKS LIKE!",
      "39°C FEVER BUT STILL WORKS",
      "SFL SIPS RED WINE IN SLO-MO",
      "CAR CRASH BEFORE CONFESSION",
      "‘YOU’RE FIRED!’ BUT STILL ROOMIES",
      "RAIN APPEARS WHEN SHE CRIES",
      "‘STAY STILL’ BEFORE MEDICINE",
      "‘I ONLY EAT YOUR NOODLES’",
      "GRANDMA KNOWS EVERYTHING",
      "OVERHEARS ONE LINE → RUNS",
      "INSTANT AMNESIA POWER",
      "FALL → CATCH → EYE CONTACT",
      "‘I’LL MARRY YOU TO SAVE COMPANY’",
      "30-SEC TRAUMA FLASHBACK",
      "VAGUE LIFE ADVICE FROM OLD MAN",
      "DRAMATIC OST AT WRONG TIME",
      "10 YEARS LATER, LOOKS THE SAME",
      "AIRPORT CHASE AT 2 AM",
      "‘SHE’S MY FIANCÉE… ARRANGED!’",
      "RANDOM ENGLISH: ‘HONEY, WAIT!’",
      "HIT BY A SLOW-MOVING CAR",
    ];

    /* MADNESS POOL = Classic ∪ Chaotic ∪ extras (dedupe) */
    const MADNESS_EXTRAS = [
      "DOCTOR/POLICE/MEDICINE FROM NOWHERE",
      "DIVORCES SCUM; MARRIES KIN",
      "ML HAS STOMACH ISSUES",
      "ONLY ONE DRESS",
      "DRAMATIC FALL & CRY"
    ];
    const TERMS_MADNESS_POOL = Array.from(
      new Set([...TERMS_CLASSIC, ...TERMS_CHAOTIC, ...MADNESS_EXTRAS])
    ); // ~50+ pozycji; losujemy 36

    /* === STATE / UTILS === */
    const THEME_KEY = 'cdrama-bingo-theme';
    const params = new URLSearchParams(location.search);
    let mode = ['classic','chaotic','madness'].includes(params.get('mode')) ? params.get('mode') : 'classic';
    let seed = params.get('seed') || Math.random().toString(36).slice(2, 10);

    const SIZE_FOR = (m)=> m==='madness' ? 6 : 5;
    const STORAGE_KEY = (s,m)=> `cdrama-bingo-v5-${m}-${s}`;

    function mulberry32(a){ return function(){ var t=a+=0x6D2B79F5; t=Math.imul(t^t>>>15,t|1); t^=t+Math.imul(t^t>>>7,t|61); return ((t^t>>>14)>>>0)/4294967296 } }
    function hashStrToInt(str){ let h=2166136261>>>0; for(let i=0;i<str.length;i++){ h^=str.charCodeAt(i); h=Math.imul(h,16777619) } return h>>>0 }
    function shuffleWithSeed(array, seedStr){
      const rng=mulberry32(hashStrToInt(seedStr));
      const arr=array.slice();
      for(let i=arr.length-1;i>0;i--){ const j=Math.floor(rng()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]] }
      return arr;
    }

    function termsForMode(){
      if(mode==='classic') return TERMS_CLASSIC;
      if(mode==='chaotic') return TERMS_CHAOTIC;
      return TERMS_MADNESS_POOL;
    }

    function saveState(seedStr, doneSet){ const data={done:[...doneSet]}; localStorage.setItem(STORAGE_KEY(seedStr,mode), JSON.stringify(data)) }
    function loadState(seedStr){ try{ const raw=localStorage.getItem(STORAGE_KEY(seedStr,mode)); if(!raw) return new Set(); const obj=JSON.parse(raw); return new Set(obj.done||[]) }catch{ return new Set() } }
    function applyTheme(){ const t=localStorage.getItem(THEME_KEY); if(t==='dark') document.body.classList.add('dark') }

    function makeLines(size){
      const arr=[];
      for(let r=0;r<size;r++) arr.push(Array.from({length:size},(_,c)=> r*size+c));
      for(let c=0;c<size;c++) arr.push(Array.from({length:size},(_,r)=> r*size+c));
      arr.push(Array.from({length:size},(_,i)=> i*size+i));
      arr.push(Array.from({length:size},(_,i)=> i*size+(size-1-i)));
      return arr;
    }

    let lines = makeLines(SIZE_FOR(mode));
    let prevBingoCount = 0;

    function showToast(msg){
      const t=document.getElementById('bingoMsg');
      t.textContent=msg;
      const box=t.parentElement;
      box.classList.add('show');
      setTimeout(()=> box.classList.remove('show'), 1500);
    }
    function showCenterPop(){
      const el=document.getElementById('centerPop');
      el.classList.remove('show'); void el.offsetWidth;
      el.classList.add('show');
      setTimeout(()=> el.classList.remove('show'), 1000);
    }

    function updateBingo(doneSet){
      let count=0; for(const line of lines){ if(line.every(i=> doneSet.has(i))) count++ }
      document.getElementById('count').textContent=String(count);
      const dot=document.querySelector('.brand .dot');
      if(count>0){ dot.classList.add('pulse') } else { dot.classList.remove('pulse') }
      if(count>prevBingoCount){ showToast('BINGO!'); showCenterPop(); }
      prevBingoCount=count;
    }

    function render(){
      const boardEl = document.getElementById('board');
      const size = SIZE_FOR(mode);
      boardEl.classList.toggle('cols-6', size===6);
      boardEl.classList.toggle('cols-5', size===5);
      boardEl.innerHTML='';

      const pool = termsForMode();
      const list = (mode==='madness')
        ? shuffleWithSeed(pool, seed).slice(0, 36)     // MADNESS: losowe 36 z dużej puli
        : shuffleWithSeed(pool, seed).slice(0, size*size);

      const done = loadState(seed);

      list.forEach((text, idx)=>{
        const tile=document.createElement('button');
        tile.className='tile';
        tile.setAttribute('role','gridcell');
        tile.setAttribute('aria-pressed', done.has(idx) ? 'true' : 'false');
        tile.dataset.idx=String(idx);
        tile.textContent=text;
        if(done.has(idx)) tile.classList.add('done');
        tile.addEventListener('click', ()=>{
          const i=Number(tile.dataset.idx);
          if(tile.classList.toggle('done')){ done.add(i); tile.setAttribute('aria-pressed','true') }
          else { done.delete(i); tile.setAttribute('aria-pressed','false') }
          saveState(seed, done); updateBingo(done);
        });
        boardEl.appendChild(tile);
      });

      lines = makeLines(size);
      prevBingoCount = 0;
      updateBingo(done);

      // byline + edition pill + shuffle availability
      const edition = document.getElementById('edition');
      const byline = document.getElementById('byline');
      const shuffleBtn = document.getElementById('shuffle');

      if(mode==='classic'){
        edition.textContent='Classic Edition';
        byline.textContent='by WildestLifeOfMine';
        edition.style.display='inline-block';
        shuffleBtn.disabled=false; shuffleBtn.title='Shuffle a new board';
      } else if(mode==='chaotic'){
        edition.textContent='Chaotic Edition';
        byline.textContent='by LameRocke';
        edition.style.display='inline-block';
        shuffleBtn.disabled=false; shuffleBtn.title='Shuffle a new board';
      } else {
        edition.textContent='Madness Edition';
        byline.textContent='by CShortDramas’ Members';
        edition.style.display='inline-block';
        shuffleBtn.disabled=false; shuffleBtn.title='Shuffle a new board';   // w Madness aktywny
      }
    }

    function setMode(newMode){
      mode=newMode;
      const url=new URL(location.href);
      url.searchParams.set('mode', mode);
      url.searchParams.set('seed', seed);
      history.replaceState(null,'',url.toString());

      document.getElementById('btnClassic').classList.toggle('active', mode==='classic');
      document.getElementById('btnClassic').setAttribute('aria-selected', mode==='classic');
      document.getElementById('btnChaotic').classList.toggle('active', mode==='chaotic');
      document.getElementById('btnChaotic').setAttribute('aria-selected', mode==='chaotic');
      document.getElementById('btnMadness').classList.toggle('active', mode==='madness');
      document.getElementById('btnMadness').setAttribute('aria-selected', mode==='madness');

      render();
    }

    function setSeed(newSeed){
      seed=newSeed;
      const url=new URL(location.href);
      url.searchParams.set('seed', seed);
      url.searchParams.set('mode', mode);
      history.replaceState(null,'',url.toString());
      render();
    }

    // INIT
    (function init(){
      applyTheme();
      document.getElementById('btnClassic').classList.toggle('active', mode==='classic');
      document.getElementById('btnClassic').setAttribute('aria-selected', mode==='classic');
      document.getElementById('btnChaotic').classList.toggle('active', mode==='chaotic');
      document.getElementById('btnChaotic').setAttribute('aria-selected', mode==='chaotic');
      document.getElementById('btnMadness').classList.toggle('active', mode==='madness');
      document.getElementById('btnMadness').setAttribute('aria-selected', mode==='madness');
      render();
    })();

    // Controls
    document.getElementById('btnClassic').addEventListener('click', ()=> setMode('classic'));
    document.getElementById('btnChaotic').addEventListener('click', ()=> setMode('chaotic'));
    document.getElementById('btnMadness').addEventListener('click', ()=> setMode('madness'));

    document.getElementById('shuffle').addEventListener('click', ()=>{
      const newSeed = Math.random().toString(36).slice(2,10);
      setSeed(newSeed);
    });

    document.getElementById('clear').addEventListener('click', ()=>{
      localStorage.removeItem( STORAGE_KEY(seed, mode) );
      render();
    });

    document.getElementById('copy').addEventListener('click', async ()=>{
      const url = location.href;
      try{
        await navigator.clipboard.writeText(url);
        const btn=document.getElementById('copy');
        const prev=btn.textContent; btn.textContent='Copied!';
        setTimeout(()=> btn.textContent=prev, 1200);
      }catch{ alert('Copy this link: '+url) }
    });

    document.getElementById('mode').addEventListener('click', ()=>{
      const dark=document.body.classList.toggle('dark');
      localStorage.setItem(THEME_KEY, dark ? 'dark' : 'light');
    });

    // AUTO-CLEAR ON EXIT (możesz usunąć, jeśli chcesz zapamiętywać)
    function clearAllStatesForCurrentSeed(){
      ['classic','chaotic','madness'].forEach(m=>{
        try{ localStorage.removeItem(`cdrama-bingo-v5-${m}-${seed}`) }catch{}
      });
    }
    window.addEventListener('beforeunload', clearAllStatesForCurrentSeed);
    document.addEventListener('visibilitychange', ()=>{ if(document.visibilityState==='hidden') clearAllStatesForCurrentSeed() });
  </script>
</body>
</html>
